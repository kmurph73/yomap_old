(function(){var a,b,c,d,e=this;c=function(a){var b;return b=function(b,c){var d,e,f;return d=void 0,f=void 0,d=[],e=new RegExp(b,"i"),$.each(a,function(a,b){return e.test(b)?d.push({value:b}):void 0}),c(d)}},d="9000"===location.port?"http://localhost:4567":"http://107.170.247.145",a=new Bloodhound({name:"territories",remote:{url:""+d+"/territories?q=%QUERY",filter:function(a){return JSON.parse(a)},ajax:{dataType:"jsonp"}},displayKey:"name",datumTokenizer:function(a){return Bloodhound.tokenizers.whitespace(a.val)},queryTokenizer:Bloodhound.tokenizers.whitespace,limit:15,templates:{empty:"",suggestion:_.template("      <p><strong><% console.log('heyo')%><%= name %></strong></p>")}}),b=a.initialize(),b.done(function(){return console.log("success!"),e.$.fn.myTypeAhead=function(){return this.typeahead({hint:!0,highlight:!0,minLength:1},{name:"stuff",displayKey:"value",source:a.ttAdapter()})}}).fail(function(){return console.log("err!")})}).call(this),function(){var a,b,c,d,e;window.App=a={},a.data=c={},e={},_.extend(e,Backbone.Events),a.vent=e,$(function(){return $(document).on("mouseenter",".tip",function(){return $(this).tooltip().tooltip("show")}),$(document).on("mouseleave",".tip",function(){return $(this).tooltip("hide")})}),b=[36.641874,-119.25006],d=function(){var a;return a={zoom:5,center:new google.maps.LatLng(b[0],b[1]),mapTypeId:google.maps.MapTypeId.TERRAIN},c.map=new google.maps.Map(document.getElementById("map-canvas"),a)},google.maps.event.addDomListener(window,"load",d)}.call(this),function(){$(function(){return App.territories=new App.TerritoryList,new App.InputView,new App.TerritoriesView,App.mapView=new App.MapView})}.call(this),function(){var a,b,c,d,e,f,g,h,i,j;a=this.App,j=this._,b=this.google.maps.LatLng,e=function(a){return j.map(a,function(a){return new b(a[1],a[0])})},f=function(a){return j.map(a,function(a){var b,c,d,f,h,i;for(c=[],f=e(g(a.outerCoords)),d=j.map(a.innerCoords,function(a){return e(g(a))}),c.push(f),h=0,i=d.length;i>h;h++)b=d[h],c.push(b);return c})},g=function(a){return j.reject(a,function(a){return a.length<2})},i="https://s3-us-west-2.amazonaws.com/yodap",h=function(a){return a*Math.PI/180},d=function(a,b){var c,d,e,f,g,i;return c=6378137,g=h(b.lat()-a.lat()),i=h(b.lng()-a.lng()),d=Math.sin(g/2)*Math.sin(g/2)+Math.cos(h(a.lat()))*Math.cos(h(b.lat()))*Math.sin(i/2)*Math.sin(i/2),e=2*Math.atan2(Math.sqrt(d),Math.sqrt(1-d)),f=c*e},a.Territory=c=Backbone.Model.extend({initialize:function(){return this.set("polygons",[])},defaults:{loaded:!1}}),c.fetchCountry=function(a,b){var c;return c=""+i+"/countries/"+a.get("abbrev")+".json",$.getJSON(c).then(function(a){var c;return c=f(a.polygons),b(c)})},c.fetchCity=function(a,b){var c;return c=""+i+"/cities/"+a.get("country")+"/"+a.get("state")+"/"+a.get("abbrev")+".json",$.getJSON(c).then(function(a){var c;return c=f(a.polygons),b(c)}).fail(function(){})},c.fetchState=function(a,b){return $.getJSON(""+i+"/states/"+a.get("abbrev")+".json").then(function(a){var c;return c=f(a.polygons),b(c)})}}.call(this),function(){var a,b,c;a=this.App,c=this._,b=a.Territory,a.TerritoryList=Backbone.Collection.extend({initialize:function(){return a.vent.on("removeTerritory",this.removeTerritory,this)},model:b,findByAttr:function(a,b){return null==b&&(b="name"),this.find(function(c){return c.get(b)===a})},findOrCreate:function(a){var b;return b=this.findWhere({abbrev:a.abbrev,state:a.state,country:a.country,type:a.type}),b||(b=this.add(a)),b},gotime:function(c){var d;return d=c.get("type"),c.data?a.vent.trigger("renderPolygon",c):"country"===d?b.fetchCountry(c,function(b){return c.polygons=b,a.vent.trigger("renderPolygon",c)}):"state"===d?b.fetchState(c,function(b){return c.polygons=b,a.vent.trigger("renderPolygon",c)}):"city"===d?b.fetchCity(c,function(b){return c.polygons=b,a.vent.trigger("renderPolygon",c)}):void 0},addList:function(a,c){var d,e,f,g,h;for(h=[],f=0,g=a.length;g>f;f++)e=a[f],d=new b(e),d.set(c),h.push(this.add(d));return h},setAll:function(a){var b,c,d,e,f,g,h,i;i=[];for(g in a)e=a[g],"countries"===g?h="country":"cities"===g?h="city":"states"===g&&(h="state"),"countries"===g?(b={type:h},i.push(this.addList(e,b))):i.push(function(){var a,g,i;for(i=[],a=0,g=e.length;g>a;a++)c=e[a],i.push(function(){var a;a=[];for(d in c)f=c[d],b={type:h,country:d},a.push(this.addList(f,b));return a}.call(this));return i}.call(this));return i},getNames:function(a){var b,d,e,f,g,h;if(d=[],c.isArray(a)){for(b=[],e=g=0,h=a.length;h>g;e=++g)f=a[e],b[e]=this.where({type:f});d=c.flatten(b)}else this.where({name:a});return c.map(d,function(a){return a.get("name")})}})}.call(this),function(){var a,b;a=this.App,b=this._,a.InputView=Backbone.View.extend({el:"#side",initialize:function(){var b;return b=a.territories.getNames(["state","country","city"]),a.territories.on("remove",this.clearInput,this),a.vent.on("renderPolygon",this.clearInput,this),$("input#countryInput").myTypeAhead(b).on("typeahead:selected",this.selected)},selected:function(b,c){var d,e;return d=$(b.currentTarget),d.val(""),e=a.territories.findOrCreate(c),a.territories.gotime(e)},clearInput:function(){return $("input#countryInput").val("")}})}.call(this),function(){var a,b;a=this.App,b=this._,a.MapView=Backbone.View.extend({el:"#map-canvas",initialize:function(){return a.vent.on("renderPolygon",this.renderTerritory,this),a.territories.on("remove",this.removeTerritory,this),a.vent.on("resetTerritory",this.resetTerritory,this),a.vent.on("centerTerritory",this.centerTerritory,this)},removeTerritory:function(a){var b,c,d,e,f;for(e=a.get("polygons"),f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.setMap(null));return f},resetTerritory:function(a){return this.removeTerritory(a),this.renderTerritory(a)},renderPolygon:function(a,b,c){var d;return d=new google.maps.Polygon({map:b,paths:c,strokeColor:"#FF0000",strokeOpacity:.8,strokeWeight:1,fillColor:"#FF0000",fillOpacity:.35,draggable:!0,geodesic:!0}),a.get("polygons").push(d)},renderTerritory:function(b){var c,d,e,f,g,h,i,j;for(d=a.data.map,c="#FF0000",f=b.get("type"),i=b.polygons,j=[],g=0,h=i.length;h>g;g++)e=i[g],j.push(this.renderPolygon(b,d,e));return j},centerTerritory:function(){var b,c;return c=a.data.map,b=c.getCenter()},kmlRender:function(){var b;return b=new google.maps.FusionTablesLayer({query:{select:"geometry",from:"1JccYMnFShp8vhqqn3WC9JysW0vSEHC7cCQ9xK0pf"},options:{polygonOptions:{draggable:!0,geodesic:!0}},styles:[{polygonOptions:{fillColor:"#00FF00",draggable:!0,geodesic:!0}}]}),b.setMap(a.data.map)}})}.call(this),function(){var a,b;a=this.App,b=this._,a.TerritoriesView=Backbone.View.extend({el:"#open-territories",initialize:function(){return a.territories.on("add",this.render,this),a.territories.on("remove",this.render,this)},events:{"click i":"clickTerritory","mouseenter .territory-item":"enterTerr","mouseleave .territory-item":"leaveTerr"},render:function(){var b,c,d,e,f,g,h;for(b="<ul>",d=a.territories.models,c=g=0,h=d.length;h>g;c=++g)e=d[c],f=e.get("type"),b+="        <span class='territory-item' id='"+f+"_"+(e.get("abbrev")||e.get("name"))+"'>          "+e.get("name")+"          <span class='right-arrow'>            <span>              <i href='#' class='fa fa-long-arrow-right'></i>            </span>          </span>          <span>            <span class='actions unimporant-hide'>              <span>                <i href='#' class='fa fa-times remove tip' title='remove'></i>              </span>              <span>                <i class='fa fa-refresh reset tip' title='reset'></i>              </span>              <span>                <i class='fa fa-arrows goto tip' title='go to "+e.get("type")+"'></i>              </span>            </span>          </span>",c+1!==d.length&&(b+="<span><i class='fa fa-circle'></i></span>"),b+="</span>";return b+="</ul>",this.$el.html(b)},leaveTerr:function(a){var b;return a.preventDefault(),b=this.$(a.currentTarget),b.find(".actions").toggle("slide",function(){return b.find(".fa-long-arrow-right").show()})},enterTerr:function(a){var b;return a.preventDefault(),b=this.$(a.currentTarget),b.find(".actions").toggle("slide",function(){return b.find(".fa-long-arrow-right").hide()})},clickTerritory:function(b){var c,d,e,f,g,h;return b.preventDefault(),e=this.$(b.currentTarget),d=e.closest("span").attr("id"),h=d.split("_"),g=h[0],c=h[1],f=a.territories.findWhere({type:g,abbrev:c}),e.hasClass("remove")?a.territories.remove(f):e.hasClass("reset")?a.vent.trigger("resetTerritory",f):e.hasClass("center")?a.vent.trigger("centerTerritory",f):void 0}})}.call(this);